<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header"></head>
<body class="sb-nav-fixed">
<nav th:replace="fragments/nav :: nav"></nav>
<div th:replace="fragments/sidenav :: sidenav"></div>
<div id="layoutAuthentication">
    <div id="layoutAuthentication_content">
        <main>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-7">
                        <div class="card shadow-lg border-0 rounded-lg mt-5">
                            <div class="card-header">
                                <h3 class="text-center font-weight-light my-4">회원가입</h3>
                            </div>
                            <div class="card-body">
                                <form th:action="@{/user/register}" method="post">
                                    <div class="form-group">
                                        <label class="small mb-1" for="uid">아이디</label>
                                        <input class="form-control py-4" type="text" id="uid" name="uid"/>
                                    </div>
                                    <div class="form-group">
                                        <label class="small mb-1" for="password">비밀번호</label>
                                        <input class="form-control py-4" type="password" id="password" name="password">
                                    </div>
                                    <div class="form-group">
                                        <label class="small mb-1" for="confirmPassword">비밀번호확인</label>
                                        <input class="form-control py-4" id="confirmPassword" type="password"
                                               name="confirmPassword">
                                        <p class="password-verification-msg"></p>
                                    </div>

                                    <div class="form-group">
                                        <label class="small mb-1" for="nickName">닉네임</label>
                                        <button class="btn btn-outline-dark" type="button"
                                                style="font-size:15px;font-weight: bold" id="chknick">중복확인
                                        </button>
                                        <input class="form-control py-4" type="text" id="nickName" name="nickName"/>
                                        <p class="nickNameVerificationMsg"></p>
                                    </div>


                                    <div class="form-group mt-4 mb-0">
                                        <button class="btn btn-primary btn-block" id="register">회원가입</button>
                                    </div>
                                </form>
                            </div>
                            <div class="card-footer text-center">
                                <div class="small"><a th:href="@{/user/login}">로그인</a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<div th:replace="fragments/footer :: footer"></div>
<th:block th:include="fragments/config :: config"></th:block>
<script>
    $(document).ready(function () {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        var isnicknamecheck = false; //nick check

        $("#register").on("click", function (e) {
            if (!$("#uid").val()) {
                alert('아이디를 입력해주세요');
                $("#username").focus();
                return false;
            }

            if (!$("#password").val()) {
                alert('비밀번호를 입력해주세요');
                $("#password").focus();
                return false;
            }
            if (!$("#confirmPassword").val()) {
                alert('비밀번호 확인을 입력해주세요');
                $("#confirmPassword").focus();
                return false;
            }

            if ($("#password").val() != $("#confirmPassword").val()) {
                alert('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
                $("#confirmPassword").focus();
                return false;
            }

            if (!isnicknamecheck) {
                alert("닉네임 중복체크를 해주세요.");
                return false;
            }
        })

        $("#confirmPassword").on("change", function () {
            var password = $("#password");
            var confirmPassword = $("#confirmPassword");
            var msg = $(".password-verification-msg");

            if (password.val() !== confirmPassword.val()) {
                msg.text("비밀번호가 일치하지 않습니다.").css("color", "red");
            } else {
                msg.text("비밀번호가 일치합니다.").css("color", "green");
            }
        });

        $("#chknick").on("click", function (e) {
            $(document).ajaxSend(function (e, xhr, options) {
                xhr.setRequestHeader(header, token);
            });

            if (!$("#nickName").val()) {
                alert("닉네임을 입력해주세요.");
                $("#nickName").focus();
                return false;
            }

            var nickNameTag = $(".nickNameVerificationMsg");
            var data = {"nickName": $("#nickName").val()}

            $.ajax({
                type: 'POST',
                url: '/user/checkNickName',
                data: data,
                success: function (data) {
                    if (data) {
                        nickNameTag.text('이미 등록된 닉네임입니다.').css("color", "red");
                        isnicknamecheck = false;
                        return false;
                    } else {
                        nickNameTag.text("사용할 수 있는 닉네임입니다.").css("color", "black");
                        isnicknamecheck = true;
                    }
                },
                error: function (request, status, error) {
                    console.log("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        });
    })
</script>
</body>
</html>
